# 浏览器输入url发生了什么

## 第一步：查询请求资源缓存
查找浏览器缓存，分析强缓存还是协商缓存，如果都没有命中，重新发起请求

## 第二步：DNS域名解析，找到服务器地址

## 第三步：简历TCP连接
- 第一次握手：TCP客户进程也是首先创建传输控制块TCB，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认
-  服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态
- 客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态

- 通过地址和服务器建立TCP连接（如果是https还会去建立TLS连接），开始传输数据


## 第四步：发起GET请求，根据URL（统一资源符）描述，返回相应报文和资源
服务器在收到浏览器发送的HTTP请求之后，会将收到的HTTP报文封装成HTTP的Request对象，并通过不同的Web服务器进行处理，处理完的结果以HTTP的Response对象返回，主要包括**状态码**，**响应头**，**响应体**文三个部分。

### **状态码**主要包括以下部分：
- 1xx：指示信息–表示请求已接收，继续处理。

- 2xx：成功–表示请求已被成功接收、理解、接受。

- 3xx：重定向–要完成请求必须进行更进一步的操作。

- 4xx：客户端错误–请求有语法错误或请求无法实现。

- 5xx：服务器端错误–服务器未能实现合法的请求。

### **响应头**
主要由Cache-Control、 Connection、Date、Pragma等组成。

### **响应体**
为服务器返回给浏览器的信息，主要由HTML，css，js，图片文件组成

## 第五步：浏览器解析文件
- 浏览器开始解析文件，如果是 gzip 格式的话会先解压一下，然后通过文件的编码格式知道该如何去解码文件
现在html文档结束之后：
- 解析html，将字节流转换为字符串
- 对字符串进行词法分析转换为token，构成代码的最小单位
- 最后转化为Node节点，连接Node节点构建DOM树（DOM Tree）
- 解析CSS文件，构建CSSOM
- 将DOM和COM连接，合成渲染树Render Tree，只有需要展示的节点和其样式信息
- 根据Render树，计算元素大小和位置，称为布局layout也叫做回流
- 根据布局树，计算元素对应的像素，称为painting也叫做重绘
- 最终交给GPU进程渲染，合成图层，呈现页面元素

## 第六步：TCP四次挥手
- A的应用进程先向其TCP发出连接释放报文段（FIN=1，序号seq=u），并停止再发送数据，主动关闭TCP连接，进入FIN-WAIT-1（终止等待1）状态，等待B的确认
- B收到连接释放报文段后即发出确认报文段，（ACK=1，确认号ack=u+1，序号seq=v），B进入CLOSE-WAIT（关闭等待）状态，此时的TCP处于半关闭状态，A到B的连接释放
- A收到B的确认后，进入FIN-WAIT-2（终止等待2）状态，等待B发出的连接释放报文段
- B没有要向A发出的数据，B发出连接释放报文段（FIN=1，ACK=1，序号seq=w，确认号ack=u+1），B进入LAST-ACK（最后确认）状态，等待A的确认
- A收到B的连接释放报文段后，对此发出确认报文段（ACK=1，seq=u+1，ack=w+1），A进入TIME-WAIT（时间等待）状态。此时TCP未释放掉，需要经过时间等待计时器设置的时间2MSL后，A才进入CLOSED状态