# 计算机网络知识

## 计算机网络层次结构
- 应用层 ：为应用程序提供服务，并管理应用程序之间的通信（SMTP、HTTP、FTP）
- 表示层 ：处理数据的标识问题，比如编码、格式转化、加密解密等
- 会话层 ：负责建立管理和断开通信连接，实现数据同步 
- 传输层 ：端到端传输数据，同时处理传输错误、控制流量等（TCP UDP） 
- 网络层 ：地址管理、路由选择（IP协议） 
- 数据链路层 ：数据分割成帧，mac寻址、差错校验、信息纠正等。（以太网） 
- 物理层 ：利用传输介质为数据链路层提供物理连接 

发送端从应用层 → 物理层 打包发送 
接收层从物理层 → 应用层 解析获取

## UDP和TCP（传输层）
- 是否面向连接：UDP传输数据之前无连接，TCP传输时三次握手、四次挥手
- 是否可靠：UDP尽最大力传输数据，只是数据的搬运工，不保证数据的有序且不丢失
- 是否有流量控制算法、谁更高效
- UDP 可以广播、多播、单播
- 应用场景
    - 实时的应用：UDP，王者荣耀、视频通话、直播
    - TCP 建立稳定的连接


## TCP

### ARQ 协议
> ARQ 协议也就是超时重传机制。通过确认和超时机制保证了数据的正确送达，ARQ 协议包含停止等待 ARQ 和连续 ARQ 两种协议

#### **停止等待 ARQ**
- 正常：只要 A 向 B 发送一段报文，都要停止发送并启动一个定时器，等待对端回应，在定时器时间内接收到对端应答就取消定时器并发送下一段报文
- 报文丢失或出错 在报文传输的过程中可能会出现丢包。这时候超过定时器设定的时间就会再次发送丢失的数据直到对端响应，所以需要每次都备份发送的数据。

    即使报文正常的传输到对端，也可能出现在传输过程中报文出错的问题。这时候对端会抛弃该报文并等待 A 端重传。

#### **ACK 超时或丢失**
- 对端传输的应答也可能出现丢失或超时的情况。那么超过定时器时间 A 端照样会重传报文。这时候 B 端收到相同序号的报文会丢弃该报文并重传应答，直到 A 端发送下一个序号的报文。
- 在超时的情况下也可能出现应答很迟到达，这时 A 端会判断该序号是否已经接收过，如果接收过只需要丢弃应答即可

### 连续 ARQ
在连续 ARQ 中，发送端拥有一个发送窗口，可以在没有收到应答的情况下持续发送窗口内的数据，这样相比停止等待 ARQ 协议来说减少了等待时间，提高了效率

连续 ARQ 中，接收端会持续不断收到报文。如果和停止等待 ARQ 中接收一个报文就发送一个应答一样，就太浪费资源了。通过累计确认，可以在收到多个报文以后统一回复一个应答报文。报文中的 ACK 标志位可以用来告诉发送端这个序号之前的数据已经全部接收到了，下次请发送这个序号后的数据。

但是累计确认也有一个弊端。在连续接收报文时，可能会遇到接收到序号 5 的报文后，并未接收到序号 6 的报文，然而序号 7 以后的报文已经接收。遇到这种情况时，ACK 只能回复 6，这样就会造成发送端重复发送数据的情况。


## 滑动窗口
> 滑动窗口解决了数据的丢包、顺序不对和流量控制问题

在 TCP 中，两端其实都维护着窗口：分别为发送端窗口和接收端窗口。